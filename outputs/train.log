2026-02-28 19:00:39 [INFO] __main__: Using existing split files
2026-02-28 19:00:39 [INFO] __main__: Using device: cuda
2026-02-28 19:00:39 [INFO] data.dataset: Loaded 1161 files from splits/train.txt
2026-02-28 19:00:39 [INFO] data.dataset: Loaded 147 files from splits/valid.txt
2026-02-28 19:00:39 [INFO] __main__: Train batches: 290, Val batches: 37
2026-02-28 19:00:39 [INFO] __main__: Generator (G) parameters: 61.57M
2026-02-28 19:00:39 [INFO] __main__: Discriminator (D) parameters: 8.30M
2026-02-28 19:00:41 [INFO] models.nn_utils: Loading pretrained weights from: /data0/yzhen/a_test_model/v5/outputs0/checkpoint_best.pt
2026-02-28 19:00:42 [INFO] models.nn_utils:   Extracted component: 'model_state_dict'
2026-02-28 19:00:42 [INFO] models.nn_utils:   Loaded 290/290 parameter tensors
2026-02-28 19:00:42 [INFO] trainer:   Registration:     OFF
2026-02-28 19:00:42 [INFO] trainer:   Discriminator:    ON
2026-02-28 19:00:42 [INFO] trainer:   Grad clipping:    5.0
2026-02-28 19:00:42 [INFO] trainer:   Grad accumulation:1 steps
2026-02-28 19:00:42 [INFO] trainer:   Label smoothing:  0.1
2026-02-28 19:00:42 [INFO] trainer:   D LR scheduler:   cosine
2026-02-28 19:00:42 [INFO] trainer: Starting training for 200 epochs
2026-02-28 19:00:42 [INFO] trainer:   Batch size:    4
2026-02-28 19:00:42 [INFO] trainer:   LR (G):        0.0002
2026-02-28 19:00:42 [INFO] trainer:   Output dir:    outputs
2026-02-28 19:00:42 [INFO] trainer: ============================================================
2026-02-28 19:00:42 [INFO] trainer: [Diagnostics] Scanning first batch for data statistics...
2026-02-28 19:01:38 [INFO] trainer:   [Raw 3C] ncct: min=-1.0000, max=1.0000, mean=-0.0684, std=0.6529
2026-02-28 19:01:38 [INFO] trainer:   [Raw 3C] cta:  min=-1.0000, max=1.0000, mean=-0.0869, std=0.6810
2026-02-28 19:01:38 [INFO] trainer:   [Raw 3C] mask: min=0.0000, max=2.0000, sum=627443, frac=0.2659
2026-02-28 19:01:38 [INFO] trainer:   [Clipping] ncct at min(-1): 28.5%, at max(+1): 1.5%
2026-02-28 19:01:38 [INFO] trainer:   [Clipping] cta  at min(-1): 30.8%, at max(+1): 3.3%
2026-02-28 19:01:38 [WARNING] trainer:   ⚠ 28.5% of NCCT voxels are clipped at min! HU range may be too narrow — lung detail is lost.
2026-02-28 19:01:38 [INFO] trainer:   [NCCT-CTA diff] mean=0.1586, max=2.0000, std=0.2574
2026-02-28 19:01:38 [INFO] trainer:   [Middle C] ncct shape=[4, 3, 256, 256], cta shape=[4, 3, 256, 256], mask shape=[4, 3, 256, 256]
2026-02-28 19:01:39 [INFO] trainer:   [G output] pred: min=-1.1091, max=1.1068, mean=-0.0387
2026-02-28 19:01:39 [INFO] trainer:   [G residual] min=-1.7012, max=1.2210, mean_abs=0.0882
2026-02-28 19:01:39 [INFO] trainer:   [Config] HU range: [-550.0, 250.0] (width=800.0 HU)
2026-02-28 19:01:39 [WARNING] trainer:   ⚠ HU range width is only 800.0 HU. For NCCT→CTA with lung, recommend at least [-1024, 600] (1624 HU).
2026-02-28 19:01:39 [INFO] trainer: ============================================================
2026-02-28 19:06:38 [INFO] trainer: Epoch 1/200 [Train] loss: 0.668412, l1: 0.197799, ssim: 0.470613, lr_G: 0.000058, gan_g: 0.637096, fm: 0.083218, d_loss: 1.038463, lr_D: 0.000058, gnorm_G: 1.607437, gnorm_D: 39.952038
2026-02-28 19:07:30 [INFO] trainer: Epoch 1/200 [Val]   loss: 0.682922, l1: 0.193361, ssim: 0.489561
2026-02-28 19:07:31 [INFO] trainer:   Saved checkpoint: outputs/checkpoint_epoch0001.pt
2026-02-28 19:07:33 [INFO] trainer:   New best validation loss: 0.682922
2026-02-28 19:07:33 [INFO] trainer:   Saved visualization grids for epoch 1
2026-02-28 19:08:16 [INFO] trainer:   [Debug E1] pred range=[-1.100, 1.146], residual_mag=0.1292, l1_vs_cta=0.1604
2026-02-28 19:08:16 [INFO] trainer:   [Debug E1] lung_l1=0.2090, bg_l1=0.1458
2026-02-28 19:13:26 [INFO] trainer: Epoch 2/200 [Train] loss: 0.671417, l1: 0.199178, ssim: 0.472239, lr_G: 0.000170, gan_g: 0.265975, fm: 0.055623, d_loss: 0.868170, lr_D: 0.000170, gnorm_G: 1.578747, gnorm_D: 33.783170
2026-02-28 19:14:19 [INFO] trainer: Epoch 2/200 [Val]   loss: 0.679168, l1: 0.195591, ssim: 0.483577
2026-02-28 19:14:20 [INFO] trainer:   Saved checkpoint: outputs/checkpoint_epoch0002.pt
2026-02-28 19:14:30 [INFO] trainer:   New best validation loss: 0.679168
2026-02-28 19:14:30 [INFO] trainer:   Saved visualization grids for epoch 2
2026-02-28 19:15:16 [INFO] trainer:   [Debug E2] pred range=[-1.104, 1.259], residual_mag=0.1169, l1_vs_cta=0.1527
2026-02-28 19:15:16 [INFO] trainer:   [Debug E2] lung_l1=0.2482, bg_l1=0.1224
2026-02-28 19:20:16 [INFO] trainer: Epoch 3/200 [Train] loss: 0.673119, l1: 0.198550, ssim: 0.474569, lr_G: 0.000200, gan_g: 0.257798, fm: 0.052294, d_loss: 0.859373, lr_D: 0.000200, gnorm_G: 1.698228, gnorm_D: 32.038247
2026-02-28 19:21:08 [INFO] trainer: Epoch 3/200 [Val]   loss: 0.691574, l1: 0.198873, ssim: 0.492701
2026-02-28 19:21:08 [INFO] trainer:   Saved visualization grids for epoch 3
2026-02-28 19:21:51 [INFO] trainer:   [Debug E3] pred range=[-1.054, 1.306], residual_mag=0.1392, l1_vs_cta=0.1547
2026-02-28 19:21:51 [INFO] trainer:   [Debug E3] lung_l1=0.2171, bg_l1=0.1358
2026-02-28 19:26:51 [INFO] trainer: Epoch 4/200 [Train] loss: 0.673778, l1: 0.198643, ssim: 0.475136, lr_G: 0.000200, gan_g: 0.261105, fm: 0.055042, d_loss: 0.860929, lr_D: 0.000200, gnorm_G: 1.798262, gnorm_D: 28.030972
2026-02-28 19:27:43 [INFO] trainer: Epoch 4/200 [Val]   loss: 0.687686, l1: 0.195769, ssim: 0.491918
2026-02-28 19:27:44 [INFO] trainer:   Saved visualization grids for epoch 4
2026-02-28 19:28:28 [INFO] trainer:   [Debug E4] pred range=[-1.066, 1.110], residual_mag=0.1130, l1_vs_cta=0.1373
2026-02-28 19:28:28 [INFO] trainer:   [Debug E4] lung_l1=0.1658, bg_l1=0.1316
2026-02-28 19:33:32 [INFO] trainer: Epoch 5/200 [Train] loss: 0.668870, l1: 0.196987, ssim: 0.471883, lr_G: 0.000200, gan_g: 0.256810, fm: 0.051029, d_loss: 0.857312, lr_D: 0.000200, gnorm_G: 1.546662, gnorm_D: 27.023308
2026-02-28 19:34:24 [INFO] trainer: Epoch 5/200 [Val]   loss: 0.664973, l1: 0.189530, ssim: 0.475443
2026-02-28 19:34:25 [INFO] trainer:   Saved checkpoint: outputs/checkpoint_epoch0005.pt
2026-02-28 19:34:35 [INFO] trainer:   New best validation loss: 0.664973
2026-02-28 19:34:36 [INFO] trainer:   Saved visualization grids for epoch 5
2026-02-28 19:35:19 [INFO] trainer:   [Debug E5] pred range=[-1.358, 1.122], residual_mag=0.1294, l1_vs_cta=0.1566
2026-02-28 19:35:19 [INFO] trainer:   [Debug E5] lung_l1=0.2235, bg_l1=0.1331
